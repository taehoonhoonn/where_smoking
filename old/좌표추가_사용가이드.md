# 좌표 추가 및 최종 데이터베이스 완성 가이드

## 📋 개요
검증된 흡연구역 주소에 카카오 API를 사용하여 정확한 위도/경도 좌표를 추가하는 시스템입니다.

## 🔑 사전 준비: 카카오 API 키 발급

### 1단계: 카카오 개발자 계정 생성
1. [https://developers.kakao.com](https://developers.kakao.com) 접속
2. 카카오 계정으로 로그인
3. "내 애플리케이션" → "애플리케이션 추가하기"
4. 앱 이름: "흡연구역찾기" (원하는 이름)
5. 회사명: 개인 또는 회사명 입력

### 2단계: REST API 키 확인
1. 생성된 앱 클릭
2. "앱 키" 탭에서 **REST API 키** 복사
3. 형태: `abc123def456...` (32자리 문자열)

### 3단계: 서비스 활성화 (필수)
1. "제품 설정" → "카카오맵" → "Local API" 활성화
2. 사용량 제한: 월 300,000건 (무료)

### 4단계: 플랫폼 등록 (필수)
1. "플랫폼" 탭 → "Web 플랫폼 등록"
2. 사이트 도메인: `http://localhost` (테스트용)

## 🚀 사용 방법

### 방법 1: .env 파일 설정 (추천)
```bash
# .env 파일의 KAKAO_API_KEY 값을 실제 API 키로 변경
KAKAO_API_KEY=your_actual_api_key_here
```

### 방법 2: 스크립트 내에서 직접 입력
스크립트 실행 중 API 키 입력 프롬프트가 나타납니다.

### 실행 명령
```bash
cd scripts
python3 add_coordinates.py
```

## 📊 처리 과정

### 1단계: 데이터 정리
- `api_우편번호` → `우편번호` 컬럼으로 이동
- 불필요한 컬럼 제거

### 2단계: 좌표 변환
- 검증 성공한 30개 주소에 대해 카카오 API 호출
- 표준화주소 우선 사용, 없으면 원본 주소 사용
- API 제한 고려 (초당 10회, 0.1초 간격)

### 3단계: 결과 저장
- `final_smoking_places_with_coordinates_YYYYMMDD_HHMMSS.csv`
- `final_summary_YYYYMMDD_HHMMSS.json`

## 📤 출력 파일 구조

### 최종 CSV 파일 컬럼
- `카테고리`: 흡연구역 형태 (부분 개방형, 완전 폐쇄형)
- `주소`: 원본 주소
- `상세`: 상세 위치 설명
- `우편번호`: 검증된 우편번호 (예: "04533")
- `표준화주소`: API로 표준화된 주소
- `지번주소`: 지번 형태 주소
- `검증상태`: "성공" 또는 "실패"
- `kakao_longitude`: 경도 (예: 126.978652)
- `kakao_latitude`: 위도 (예: 37.566826)
- `좌표변환상태`: "성공" 또는 "실패"

### 요약 JSON 파일
```json
{
  "total_addresses": 36,
  "verified_addresses": 30,
  "addresses_with_coordinates": 30,
  "complete_addresses": 30,
  "verification_rate": 83.33,
  "coordinate_rate": 100.0,
  "complete_rate": 83.33
}
```

## ⏱️ 예상 처리 시간
- **30개 주소**: 약 3-5분
- **API 호출 간격**: 0.1초 (카카오 제한 준수)
- **실시간 진행률**: 5개마다 표시

## 🔧 문제 해결

### API 키 관련 오류
```
❌ API 오류: 401 Unauthorized
```
**해결방법:**
- API 키 확인
- 카카오 개발자 콘솔에서 앱 상태 확인
- 플랫폼 등록 상태 확인

### 할당량 초과 오류
```
❌ API 오류: 429 Too Many Requests
```
**해결방법:**
- 잠시 대기 후 재시도
- 카카오 개발자 콘솔에서 사용량 확인

### 주소 검색 실패
```
❌ 실패 - 검색 결과 없음
```
**해결방법:**
- 정상적인 현상 (일부 주소는 검색 안됨)
- 표준화주소로 재시도
- 수동으로 주소 수정 후 재실행

## 📈 성공률 예상
- **우편번호 검증**: 83.3% (30/36개)
- **좌표 변환**: 90-95% 예상 (27-28/30개)
- **완전한 데이터**: 75-80% 예상 (27-29/36개)

## 🎯 완전한 데이터 기준
다음 정보가 모두 있는 경우:
- ✅ 우편번호
- ✅ 표준화주소
- ✅ 위도/경도 좌표
- ✅ 카테고리 정보
- ✅ 상세 위치

## 🔄 재처리 방법

### 실패한 주소만 재처리
1. 출력 CSV에서 `좌표변환상태`가 "실패"인 행 확인
2. 주소 수정 후 해당 행만 별도 파일로 저장
3. 스크립트 재실행

### 전체 재처리
```bash
python3 add_coordinates.py
```
기존 결과를 덮어쓰지 않고 새 파일로 저장됩니다.

## 📞 다음 단계
완성된 데이터로 가능한 작업:
1. **GeoJSON 변환**: 지도 라이브러리 호환
2. **데이터베이스 저장**: PostgreSQL + PostGIS
3. **지도 앱 개발**: React Native + 카카오맵
4. **API 서버 구축**: 위치기반 검색 서비스

## 💡 사용 팁
- 처음 실행 시 소량 테스트 (3-5개 주소)
- API 키는 환경변수로 관리 (보안)
- 결과 파일은 백업 보관
- 실패한 주소는 수동 검토 후 재처리